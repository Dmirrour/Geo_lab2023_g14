<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" lang="es" xml:lang="es">

<h:head>
   <!-- VERIFICAR SESION -->
   <f:event type="preRenderView" listener="#{sesion.verificarSesion()}"></f:event>

   <!-- VERIFICAR SESION -->
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   <title>Administrador</title>

   <!-- MAPA CSS -->
   <link rel="stylesheet" href="lib/css/leaflet.css" />
   <link rel="stylesheet" href="lib/css/leaflet.draw.css" />
   <link rel="stylesheet" href="lib/css/leaflet.draw-shapefile.css" />

   <!-- BOOTSTRAP -->
   <link rel="stylesheet" href="lib/css/style.css" />
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>

   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

   <!-- MAPA JS -->
   <script type="" src="lib/js/leaflet-src-admin.js"></script>
   <script type="" src="lib/js/leaflet.draw-src-admin.js"></script>
   <script type="" src="lib/js/leaflet.draw-shapefile.js"></script>
   <script type="" src="lib/js/class.Configuracion.js"></script>
   <script type="" src="lib/js/class.ControladorMapa.js"></script>
   <script type="" src="../scripts/geolet.js"></script>

   <!-- JTS -->
   <script type="" src="https://cdn.jsdelivr.net/npm/elm-pep@1.0.6/dist/elm-pep.js"></script>
   <script type="" src="https://cdn.jsdelivr.net/npm/jsts@2.3.0/dist/jsts.min.js"></script>
   <script type="" src="../scripts/lib/buscador/axios.min.js"></script>
   <link rel="stylesheet" href="../scripts/lib/buscador/fontawesome6.all.min.css" />


   <!-- CONSULTAS query -->
   <script type="" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script type="" src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

   <!-- ICONOS -->
   <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces" />
   <link rel="stylesheet" href="https://unpkg.com/primeflex@^3/primeflex.css" />

   <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/0.0.124/turf.min.js" integrity="sha512-jpnZ8xGKbS7L9S6d5fk/zDVgF6OoVKLMoEliLxf24BRX+orWhxqJuUcoM+vGmOaozS9dD9ABjQZKAgjjcwTndA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <script src="https://cdn.jsdelivr.net/npm/@turf/turf@5/turf.min.js"></script>

   #{sesion.init()}
   #{adminBean.initH()}
   #{servicioEBean.initS()}
   #{adminBean.initA()}

</h:head>

<h:body>

   <p:growl id="messages" showDetail="true" autoUpdate="true" />
   <div id="top">
      <div class="navbar navbar-expand-sm">
         <div class="container-fluid">
            <div id="contenedorNavbar">
               <p:menubar>
                  <p:submenu label="Eliminar">
                     <p:menuitem value="Eliminar Hospital" type="button" icon="pi pi-external-link" onclick="ocultarDlgs(); PF('dlg8').show()" />
                     <p:menuitem value="Eliminar Ambulancia" type="button" icon="pi pi-external-link" onclick="ocultarDlgs(); PF('dlg7').show()" />
                     <p:menuitem value="Eliminar S. Emergencia" type="button" icon="pi pi-external-link" onclick="ocultarDlgs(); PF('dlg6').show()" />
                  </p:submenu>
                  <p:submenu label="Modificar">
                     <p:menuitem value="Modificar Ambulancia" type="button" icon="pi pi-external-link" onclick="ocultarDlgs(); PF('dlg5').show()" />
                     <p:menuitem value="Modificar S. Emergencia" type="button" icon="pi pi-external-link" onclick="ocultarDlgs(); PF('dlg4').show(); mostrarMarker2('#{servicioEBean.size}');" />
                  </p:submenu>
                  <p:submenu label="Alta">
                     <p:menuitem value="Alta Hospital" type="button" icon="pi pi-external-link" onclick="ocultarDlgs(); PF('dlg1').show()" />
                     <p:menuitem value="Alta Ambulancia" type="button" icon="pi pi-external-link" onclick="ocultarDlgs(); PF('dlg2').show()" />
                     <p:menuitem value="Alta S. Emergencia" type="button" icon="pi pi-external-link" onclick="ocultarDlgs(); PF('dlg3').show(); mostrarMarker();" oncomplete="" />
                  </p:submenu>
               </p:menubar>
            </div>
            <div id="contenedorMnuSalir">
               <h:form id="frmSalir">
                  <p:commandButton id="frmBtnSalir" value="Salir" action="#{sesion.cerrarSesion()}" class="btn btn-rojo" icon="pi pi-power-off" />
               </h:form>
            </div>
            <div id="contenedorTitulo">
               <h2 class="bg">
                  <h:outputText styleClass="textoborde" value="Bienvenido #{sessionScope.usuario.usuario}" />
               </h2>
            </div>
         </div>
      </div>
   </div>
   <div id="map"></div>

   <!-- FORM'S  -->
   <p:outputPanel id="formPanel">
      <ui:include src="lib/forms/altaAmbulancia.xhtml" />
      <ui:include src="lib/forms/altaHospital.xhtml" />
      <ui:include src="lib/forms/altaServicioEmergencia.xhtml" />
      <ui:include src="lib/forms/eliminarAmbulancia.xhtml" />
      <ui:include src="lib/forms/eliminarHospital.xhtml" />
      <ui:include src="lib/forms/eliminarSE.xhtml" />
      <ui:include src="lib/forms/modificarSE.xhtml" />
      <ui:include src="lib/forms/modificarAmbu.xhtml" />
      <ui:include src="lib/forms/AmbulaciaFueraService.xhtml" />

   </p:outputPanel>
   <!-- END FORMS -->

   <div id="contenedorFrmBuscar" style="display: none;">
      <form id="frmBuscador" action="#" method="post">
         <div id="ubicacion">
            <div class="card card-header-actions border-success mb-4">
               <div class="card-header ">
                  <div class="input-group">
                     <span class="input-group-text" id="basic-addon3">Calle</span>
                     <input type="text" placeholder="Escriba el nombre de la calle..." class="form-control buscador-fluid" id="buscador" name="buscador" onkeyup="mapaAdmin.sugerencia(this.value)" aria-describedby="basic-addon3 basic-addon4" />
                  </div>
                  <div class="dropdown-notifications">
                     <div class="dropdown-menu dropdown-menu-right border-0 shadow" id="" aria-labelledby="navbarDropdownAlerts">
                     </div>
                  </div>
               </div>
               <div class="card-body">
                  <div class="row justify-content-center">
                     <!-- notificaciones -->
                     <div class="dropdown-notifications">
                        <div class="dropdown-menu dropdown-menu-right border-0 shadow" id="visorDeListado" aria-labelledby="navbarDropdownAlerts">
                        </div>
                     </div>
                     <div class="row">
                        <div class="col-md-12">
                           <div class="row">
                              <!-- departamento -->
                              <div class="col-md-6">
                                 <label for="departamento" class="form-label">Departamento</label>
                                 <input type="text" class="form-control" id="departamento" name="departamento" disabled="disabled" />
                              </div>
                              <!-- localidad -->
                              <div class="col-md-6">
                                 <label for="barrio" class="form-label">Localidad</label>
                                 <input type="text" class="form-control" id="barrio" name="barrio" disabled="disabled" />
                              </div>
                              <!-- calle -->
                              <div class="col-md-12 pb-4">
                                 <label for="calle" class="form-label">Calle</label>
                                 <input type="text" class="form-control" id="calle" name="calle" disabled="disabled" />
                              </div>
                              <!-- Acordeón 1: Selector de esquina -->
                              <div class="col-md-12">
                                 <div class="accordion" id="acordeonEsquina">
                                    <div class="accordion-item">
                                       <h2 class="accordion-header" id="headingEsquina">
                                          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEsquina" aria-expanded="true" aria-controls="collapseEsquina">
                                             Esquina
                                          </button>
                                       </h2>
                                       <div id="collapseEsquina" class="accordion-collapse collapse show" aria-labelledby="headingEsquina" data-bs-parent="#acordeonEsquina">
                                          <div class="accordion-body">
                                             <div class="col-md-12" id="esquinaDiv">
                                                <input type="text" class="form-control" id="idSelectEsquina" name="idSelectEsquina" value="" disabled="disabled" />
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                              <!-- Acordeón 2: Número de calle y botón de búsqueda -->
                              <div class="col-md-12">
                                 <div class="accordion" id="acordeonNumero">
                                    <div class="accordion-item">
                                       <h2 class="accordion-header" id="headingNumero">
                                          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNumero" aria-expanded="false" aria-controls="collapseNumero">
                                             Número de calle y búsqueda
                                          </button>
                                       </h2>
                                       <div id="collapseNumero" class="accordion-collapse collapse" aria-labelledby="headingNumero" data-bs-parent="#acordeonNumero">
                                          <div class="accordion-body">
                                             <div class="row">
                                                <div class="col-md-6">
                                                   <input type="number" placeholder="Numero" class="form-control" id="numeroCalle" name="numeroCalle" />
                                                </div>
                                                <div class="col-md-6">
                                                   <button type="button" class="btn btn-primary" onclick="mapaAdmin.buscarCalleNumero(this);">Buscar</button>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                              <input type="text" style="visibility: hidden;" id="direccion" name="Direccion" value="" disabled="disabled" />
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </form>
   </div>
</h:body>
<script>
   var collapseEsquina = new bootstrap.Collapse(document.getElementById("collapseEsquina"));//este tira un error en cosola
   var collapseNumero = new bootstrap.Collapse(document.getElementById("collapseNumero"));
</script>
<script>
   // Escuchar el evento de mostrar el acordeón de Esquina
   document.getElementById("acordeonEsquina").addEventListener("show.bs.collapse", function () {
      collapseNumero.hide(); // Ocultar el acordeón de Número
   });

   // Escuchar el evento de mostrar el acordeón de Número
   document.getElementById("acordeonNumero").addEventListener("show.bs.collapse", function () {
      collapseEsquina.hide(); // Ocultar el acordeón de Esquina
   });
</script>
<!-- script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
   <script type="" src="./lib/dist/webgl-heatmap.js"></script>
   <script type="" src="./lib/dist/webgl-heatmap-leaflet.min.js"></script -->
<script type="" src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
<script type="text/javascript">
   function ocultarDlgs() {
      PF('dlg1').hide();
      PF('dlg2').hide();
      PF('dlg3').hide();
      PF('dlg4').hide();
      PF('dlg6').hide();
      PF('dlg7').hide();
      PF('dlg8').hide();
      PF('dlg9').hide();
   }
   function actualizarD() {
      PF('dlg2').refresh()
      PF('dlg3').refresh()
      PF('dlg8').refresh()
   }

   let mapaAdmin = new ControladorMapa();
   mapaAdmin.crearMapaAdmin();

   function mostrarMarker() {
      mapaAdmin.cargarMapaAltaSE();
   }
   function mostrarMarker2(date) {
      mapaAdmin.cargarMapaModSE(date);
   }

   // Botón de mostrar/ocultar servicio con mas ambulancias
   var btnCobertura = document.getElementById("btnServMasAmb");
   btnCobertura.addEventListener("click", function () {
      //console.log("click en btnServMasAmb");
      if (mapaAdmin.capaAddLayerWFSbufferNoIntersect != null) {
         btnCobertura.style.backgroundColor = '#f4f4f4';
         mapaAdmin.capaAddLayerWFSbufferNoIntersect.remove();
         mapaAdmin.capaAddLayerWFSbufferNoIntersect = null;
      } else {
         // Servicio con mas ambulancias
         mapaAdmin.addLayerWFSbufferNoIntersect();
         btnCobertura.style.backgroundColor = '#f60707';
      }
   });
   $(document).ready(function () {
      $(btnCobertura).tooltip({
         placement: "left",
         title: "Servicios con mas ambulancias.",
         trigger: "hover"
      });
   });

   // Botón de mostrar/ocultar servicios de emergecnia
   var btnMOSE = document.getElementById("btnMOSerEme");
   btnMOSE.addEventListener("click", function () {
      //console.log("click en btnMOSerEme");
      if (mapaAdmin.capaAddLayerWFSSE != null) {
         btnMOSE.style.backgroundColor = '#f4f4f4';
         mapaAdmin.capaAddLayerWFSSE.remove();
         mapaAdmin.capaAddLayerWFSSE = null;
      } else {
         // Servicios de emergencia
         btnMOSE.style.backgroundColor = '#f60707';
         mapaAdmin.addLayersWFS();
      }
   });
   $(document).ready(function() {
      $(btnMOSE).tooltip({
         placement: "left",
         title: "Servicios de emergencia.",
         trigger: "hover"
      });
   });

   // Botón de mostrar/ocultar recorridos
   var btnMORecorridos = document.getElementById("btnMORecorridos");
   btnMORecorridos.addEventListener("click", function () {
      //console.log("click en btnMORecorridos");
      if (mapaAdmin.capaAddLayerWFSLine != null) {
         btnMORecorridos.style.backgroundColor = '#f4f4f4';
         mapaAdmin.capaAddLayerWFSLine.remove();
         mapaAdmin.capaAddLayerWFSLine = null;
      } else {
         // Recorridos
         btnMORecorridos.style.backgroundColor = '#f60707';
         mapaAdmin.addLayerWFSLine();
      }
   });
   $(document).ready(function() {
      $(btnMORecorridos).tooltip({
         placement: "left",
         title: "Recorridos de ambulancias.",
         trigger: "hover"
      });
   });

   // Botón de mostrar/ocultar zonas sin cobertura
   var btnZsC = document.getElementById("btnZsC");
   btnZsC.addEventListener("click", function () {
      //console.log("click en btnZsC");
      if (mapaAdmin.capaAddLayerWFSZonaSCobertura != null) {
         //console.log("click en btnZsC deberia borrar la capa");
         btnZsC.style.backgroundColor = '#f4f4f4';
         mapaAdmin.capaAddLayerWFSZonaSCobertura.remove();
         mapaAdmin.capaAddLayerWFSZonaSCobertura = null;
      } else {
         // zonas sin cobertura
         //console.log("click en btnZsC deberia agregar la capa");
         btnZsC.style.backgroundColor = '#f60707';
         mapaAdmin.zonasSinCobertura();
      }
   });
   $(document).ready(function() {
      $(btnZsC).tooltip({
         placement: "left",
         title: "Zonas sin cobertura en Montevideo.",
         trigger: "hover"
      });
   });

   // Botón de mostrar/ocultar buffer
   var btnMOBuffer = document.getElementById("btnMBuffer");
   btnMOBuffer.addEventListener("click", function () {
      //console.log("click en btnMBuffer");
      if (mapaAdmin.capaAddLayerWFSbuf != null) {
         btnMOBuffer.style.backgroundColor = '#f4f4f4';
         mapaAdmin.capaAddLayerWFSbuf.remove();
         mapaAdmin.capaAddLayerWFSbuf = null;
      } else {
         // buffer
         btnMOBuffer.style.backgroundColor = '#f60707';
         mapaAdmin.addLayerWFSbuf();
      }
   });
   $(document).ready(function() {
      $(btnMOBuffer).tooltip({
         placement: "left",
         title: "Buffer de ambulancias.",
         trigger: "hover"
      });
   });

   mapaAdmin.cargarMapaAltaAmbulancia(#{ adminBean.size });
</script>
<script type="text/javascript">
   $(document).ready(function () {
      var showDialogs = '#{param.showDialogs}';
      console.log('entre al script');
      if (showDialogs === 'true') {
         PF('dlg9').show();
         console.log('Diálogos mostrados');
      }
   });

   // Boton de limpiar
   var btnLimpiar = document.getElementById("btnLimpiar");
   $(document).ready(function() {
      $(btnLimpiar).tooltip({
         placement: "left",
         title: "Limpiar el mapa.",
         trigger: "hover"
      });
   });

   // Botono de formulario
   var btnFormulario = document.getElementById("mostrarBuscador");
   $(document).ready(function() {
      $(btnFormulario).tooltip({
         placement: "left",
         title: "Mostrar formulario de búsqueda.",
         trigger: "hover"
      });
   });

   // Botono ubicacio por GPS
   var btnUbicacion = document.getElementById("btnGPS");
   $(document).ready(function() {
      $(btnUbicacion).tooltip({
         placement: "left",
         title: "Ubicación por GPS.",
         trigger: "hover"
      });
   });

   function toggleNavbar() {
      var menuBar = document.getElementById("menuBar");

      if (menuBar.style.display === "none") {
         menuBar.style.display = "block";
      } else {
         menuBar.style.display = "none";
      }
   }
</script>

</html>