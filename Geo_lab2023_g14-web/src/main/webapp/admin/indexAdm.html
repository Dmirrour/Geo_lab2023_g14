<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/html">
<head>
   <!-- VERIFICAR SESION -->
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   <title>Administrador</title>

   <!-- MAPA CSS -->
   <link rel="stylesheet" href="lib/css/leaflet.css" />
   <link rel="stylesheet" href="lib/css/leaflet.draw.css" />
   <link rel="stylesheet" href="lib/css/leaflet.draw-shapefile.css" />

   <!-- BOOTSTRAP -->
   <link rel="stylesheet" href="lib/css/style.css" />
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>

   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

   <!-- MAPA JS -->
   <script type="" src="lib/js/leaflet-src-admin.js"></script>
   <script type="" src="lib/js/leaflet.draw-src-admin.js"></script>
   <script type="" src="lib/js/leaflet.draw-shapefile.js"></script>
   <script type="" src="lib/js/class.Configuracion.js"></script>
   <script type="" src="lib/js/class.ControladorMapa.js"></script>
   <script type="" src="../scripts/geolet.js"></script>

   <!-- JTS -->
   <script type="" src="https://cdn.jsdelivr.net/npm/elm-pep@1.0.6/dist/elm-pep.js"></script>
   <script type="" src="https://cdn.jsdelivr.net/npm/jsts@2.3.0/dist/jsts.min.js"></script>
   <script type="" src="../scripts/lib/buscador/axios.min.js"></script>
   <link rel="stylesheet" href="../scripts/lib/buscador/fontawesome6.all.min.css" />


   <!-- CONSULTAS query -->
   <script type="" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script type="" src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

   <!-- ICONOS -->
   <link rel="stylesheet" href="https://unpkg.com/primeflex@^3/primeflex.css" />

   <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/0.0.124/turf.min.js" integrity="sha512-jpnZ8xGKbS7L9S6d5fk/zDVgF6OoVKLMoEliLxf24BRX+orWhxqJuUcoM+vGmOaozS9dD9ABjQZKAgjjcwTndA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


</head>

<body>

   <div id="map"></div>

   <div id="contenedorFrmBuscar" style="display: none;">
      <form id="frmBuscador" action="#" method="post">
         <div id="ubicacion">
            <div class="card card-header-actions border-success mb-4">
               <div class="card-header ">
                  <div class="input-group">
                     <span class="input-group-text" id="basic-addon3">Calle</span>
                     <input type="text" placeholder="Escriba el nombre de la calle..." class="form-control buscador-fluid" id="buscador" name="buscador" onkeyup="mapaAdmin.sugerencia(this.value)" aria-describedby="basic-addon3 basic-addon4" />
                  </div>
                  <div class="dropdown-notifications">
                     <div class="dropdown-menu dropdown-menu-right border-0 shadow" id="" aria-labelledby="navbarDropdownAlerts">
                     </div>
                  </div>
               </div>
               <div class="card-body">
                  <div class="row justify-content-center">
                     <!-- notificaciones -->
                     <div class="dropdown-notifications">
                        <div class="dropdown-menu dropdown-menu-right border-0 shadow" id="visorDeListado" aria-labelledby="navbarDropdownAlerts">
                        </div>
                     </div>
                     <div class="row">
                        <div class="col-md-12">
                           <div class="row">
                              <!-- departamento -->
                              <div class="col-md-6">
                                 <label for="departamento" class="form-label">Departamento</label>
                                 <input type="text" class="form-control" id="departamento" name="departamento" disabled="disabled" />
                              </div>
                              <!-- localidad -->
                              <div class="col-md-6">
                                 <label for="barrio" class="form-label">Localidad</label>
                                 <input type="text" class="form-control" id="barrio" name="barrio" disabled="disabled" />
                              </div>
                              <!-- calle -->
                              <div class="col-md-12 pb-4">
                                 <label for="calle" class="form-label">Calle</label>
                                 <input type="text" class="form-control" id="calle" name="calle" disabled="disabled" />
                              </div>
                              <!-- Acordeón 1: Selector de esquina -->
                              <div class="col-md-12">
                                 <div class="accordion" id="acordeonEsquina">
                                    <div class="accordion-item">
                                       <h2 class="accordion-header" id="headingEsquina">
                                          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEsquina" aria-expanded="true" aria-controls="collapseEsquina">
                                             Esquina
                                          </button>
                                       </h2>
                                       <div id="collapseEsquina" class="accordion-collapse collapse show" aria-labelledby="headingEsquina" data-bs-parent="#acordeonEsquina">
                                          <div class="accordion-body">
                                             <div class="col-md-12" id="esquinaDiv">
                                                <input type="text" class="form-control" id="idSelectEsquina" name="idSelectEsquina" value="" disabled="disabled" />
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                              <!-- Acordeón 2: Número de calle y botón de búsqueda -->
                              <div class="col-md-12">
                                 <div class="accordion" id="acordeonNumero">
                                    <div class="accordion-item">
                                       <h2 class="accordion-header" id="headingNumero">
                                          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNumero" aria-expanded="false" aria-controls="collapseNumero">
                                             Número de calle y búsqueda
                                          </button>
                                       </h2>
                                       <div id="collapseNumero" class="accordion-collapse collapse" aria-labelledby="headingNumero" data-bs-parent="#acordeonNumero">
                                          <div class="accordion-body">
                                             <div class="row">
                                                <div class="col-md-6">
                                                   <input type="number" placeholder="Numero" class="form-control" id="numeroCalle" name="numeroCalle" />
                                                </div>
                                                <div class="col-md-6">
                                                   <button type="button" class="btn btn-primary" onclick="mapaAdmin.buscarCalleNumero(this);">Buscar</button>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                              <input type="text" style="visibility: hidden;" id="direccion" name="Direccion" value="" disabled="disabled" />
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </form>
   </div>
</body>
   <script>
      var collapseEsquina = new bootstrap.Collapse(document.getElementById("collapseEsquina"));//este tira un error en cosola
      var collapseNumero = new bootstrap.Collapse(document.getElementById("collapseNumero"));

      // Escuchar el evento de mostrar el acordeón de Esquina
      document.getElementById("acordeonEsquina").addEventListener("show.bs.collapse", function () {
         collapseNumero.hide(); // Ocultar el acordeón de Número
      });

      // Escuchar el evento de mostrar el acordeón de Número
      document.getElementById("acordeonNumero").addEventListener("show.bs.collapse", function () {
         collapseEsquina.hide(); // Ocultar el acordeón de Esquina
      });
   </script>
   <script type="text/javascript" src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
   <script type="text/javascript">
      function ocultarDlgs() {
         PF('dlg1').hide();
         PF('dlg2').hide();
         PF('dlg3').hide();
         PF('dlg4').hide();
         PF('dlg6').hide();
         PF('dlg7').hide();
         PF('dlg8').hide();
         PF('dlg9').hide();
      }
      function actualizarD() {
         PF('dlg2').refresh()
         PF('dlg3').refresh()
         PF('dlg8').refresh()
      }

      let mapaAdmin = new ControladorMapa();
      mapaAdmin.crearMapaAdmin();
      //mapaAdmin.addLayerWFSbuf();
      //mapaAdmin.addLayersWFS();
      //mapaAdmin.addLayerWFSLine();

      function mostrarMarker() {
         mapaAdmin.cargarMapaAltaSE();
      }
      function mostrarMarker2(date) {
         mapaAdmin.cargarMapaModSE(date);
      }

      // Botón de mostrar/ocultar servicio con mas ambulancias
      var btnCobertura = document.getElementById("btnServMasAmb");
      btnCobertura.addEventListener("click", function () {
         console.log("click en btnServMasAmb");

         if (mapaAdmin.capaAddLayerWFSbufferNoIntersect != null) {
            btnCobertura.style.backgroundColor = '#f4f4f4';
            mapaAdmin.capaAddLayerWFSbufferNoIntersect.remove();
            mapaAdmin.capaAddLayerWFSbufferNoIntersect = null;
         }else {
            // Servicio con mas ambulancias
            mapaAdmin.addLayerWFSbufferNoIntersect();
            btnCobertura.style.backgroundColor = '#f60707';
         }
      });
      $(document).ready(function() {
         $(btnCobertura).tooltip({
            placement: "left",
            title: "Servicios con mas ambulancias.",
            trigger: "hover"
         });
      });

      // Botón de mostrar/ocultar servicios de emergecnia
      var btnMOSE = document.getElementById("btnMOSerEme");
      btnMOSE.addEventListener("click", function () {
          console.log("click en btnMOSerEme");
          if (mapaAdmin.capaAddLayerWFSSE != null) {
             btnMOSE.style.backgroundColor = '#f4f4f4';
             mapaAdmin.capaAddLayerWFSSE.remove();
             mapaAdmin.capaAddLayerWFSSE = null;
          }else {
             // Servicios de emergencia
             btnMOSE.style.backgroundColor = '#f60707';
             mapaAdmin.addLayersWFS();
          }
      });

      // Botón de mostrar/ocultar recorridos
      var btnMORecorridos = document.getElementById("btnMORecorridos");
      btnMORecorridos.addEventListener("click", function () {
         console.log("click en btnMORecorridos");
         if (mapaAdmin.capaAddLayerWFSLine != null) {
              btnMORecorridos.style.backgroundColor = '#f4f4f4';
              mapaAdmin.capaAddLayerWFSLine.remove();
              mapaAdmin.capaAddLayerWFSLine = null;
         }else {
              // Recorridos
              btnMORecorridos.style.backgroundColor = '#f60707';
              mapaAdmin.addLayerWFSLine();
         }
      });

      // Botón de mostrar/ocultar buffer
      var btnMOBuffer = document.getElementById("btnMBuffer");
      btnMOBuffer.addEventListener("click", function () {
          console.log("click en btnMBuffer");
          if (mapaAdmin.capaAddLayerWFSbuf != null) {
             btnMOBuffer.style.backgroundColor = '#f4f4f4';
             mapaAdmin.capaAddLayerWFSbuf.remove();
             mapaAdmin.capaAddLayerWFSbuf = null;
          }else {
             // buffer
             btnMOBuffer.style.backgroundColor = '#f60707';
             mapaAdmin.addLayerWFSbuf();
          }
      });
      $(document).ready(function() {
         $(btnMOBuffer).tooltip({
            placement: "left",
            title: "Mostrar/Ocultar zonas CON cobertura.",
            trigger: "hover"
         });
      });


   </script>
   <script type="text/javascript">
      $(document).ready(function () {
         var showDialogs = '#{param.showDialogs}';
         console.log('entre al script');
         if (showDialogs === 'true') {
            PF('dlg9').show();
            console.log('Diálogos mostrados');
         }
      });

      function toggleNavbar() {
         var menuBar = document.getElementById("menuBar");

         if (menuBar.style.display === "none") {
            menuBar.style.display = "block";
         } else {
            menuBar.style.display = "none";
         }
      }
   </script>
</html>